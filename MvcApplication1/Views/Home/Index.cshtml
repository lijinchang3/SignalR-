@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
    <!--注意signalr要在jquery引用之下-->
    <!--Reference the SignalR library. -->
    <script src="../../Scripts/jquery.signalR-1.1.4.min.js" type="text/javascript"></script>
    <!--Reference the autogenerated SignalR hub script. 注意一定别忘记写这句，signalr生成的脚本都在这-->
    <script src="~/signalr/hubs"></script>
<h1>流程演示</h1>
<input type="hidden" id="displayname" />
<h2 id="thisname"></h2><br />

<select id="username" style="width:153px;">
</select>
<input id="send" type="button" value="发送" />
<div>
<h1 id="messgae"></h1>
</div>
<script type="text/javascript">
    $(function () {

       //前端Hub的使用，注意的是，Hub的名字是WorkflowHub，这里使用时首字母小写
        var work = $.connection.workflowHub;

        $('#displayname').val(prompt('请输入昵称:', ''));
        $('#thisname').text('当前用户：'+$('#displayname').val());

        //对应后端的SendMessage函数，消息接收函数
        work.client.sendMessage = function (message) {
            $('#messgae').append(message + '</br>')
        };

        //后端SendLogin调用后，产生的loginUser回调
        work.client.loginUser = function (userlist) {
            reloadUser(userlist);
        };

        //hub连接开启
        $.connection.hub.start().done(function () {

            var username = $('#displayname').val();

            //发送上线信息
            work.server.sendLogin(username);

            //点击按钮，发送消息
            $('#send').click(function () {
                var friend = $('#username').val();
                //调用后端函数，发送指定消息
                work.server.sendByGroup(username, friend);
            });

        });
    });

    //重新加载用户列表
    var reloadUser = function (userlist) {
        $("#username").empty(); 
        for (i = 0; i < userlist.length; i++) {
            $("#username").append("<option value="+userlist[i]+">"+userlist[i]+"</option>");
        }
    }
</script>